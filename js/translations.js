/**
 * Wedding E-Ticket â€” Multi-language translations (KO default, EN, KM)
 * Names are not translated; use same in all languages.
 */
const translations = {
  ko: {
    pageTitle: "ê²°í˜¼ì‹ ì´ˆëŒ€ìž¥",
    heroTopline: "W E D D I N G   I N V I T A T I O N",
    heroTitle: "ê²°í˜¼ì‹ ì´ˆëŒ€ìž¥",
    guestLabel: "ì´ˆëŒ€í•©ë‹ˆë‹¤",
    invitationMessage: "ëˆˆë¶€ì‹œê²Œ ì°¬ëž€í•œ ë‚ , ì €í¬ ë¶€ë¶€ê°€ ë©ë‹ˆë‹¤.\nìž‘ì€ ì¼ìƒì´ ì¼ìƒì´ ë˜ëŠ” ë‚ ,\në‚˜ëž€ížˆ ì˜ˆì˜ê²Œ ì‚´ì•„ê°€ê² ìŠµë‹ˆë‹¤.\n\nìš°ë¦¬ì˜ ì²« ê±¸ìŒì„\nì¶•ë³µí•´ ì£¼ì‹œê¸° ë°”ëžë‹ˆë‹¤.",
    dateLine: "2026ë…„ 3ì›” 24ì¼â€“25ì¼",
    cdDays: "ì¼",
    cdHours: "ì‹œê°„",
    cdMins: "ë¶„",
    cdSecs: "ì´ˆ",
    venueTitle: "ì‹ìž¥ ì•ˆë‚´",
    venueSubtitle: "ìž¥ì†Œ ì´ë¦„",
    mapClick: "Google ì§€ë„ì—ì„œ ë³´ê¸°",
    openMaps: "Google ì§€ë„ì—ì„œ ì—´ê¸°",
    scanQR: "QR ì½”ë“œ ìŠ¤ìº”",
    sectionSchedule: "ê²°í˜¼ì‹ í”„ë¡œê·¸ëž¨",
    sectionScheduleSub: "2026ë…„ 3ì›” 25ì¼ í”„ë¡œê·¸ëž¨",
    scheduleDate: "ðŸ—“ 2026ë…„ 3ì›” 25ì¼",
    sectionVenue: "ì˜¤ì‹œëŠ” ê¸¸",
    sectionGallery: "ì‚¬ì§„",
    sectionGallerySub: "ê²°í˜¼ì‹ ì‚¬ì§„",
    sectionGift: "ë§ˆìŒ ì „í•˜ì‹¤ ê³³",
    giftDesc: "ì°¸ì„í•´ ì£¼ì‹œëŠ” ê²ƒë§Œìœ¼ë¡œë„ í° ê¸°ì¨ìž…ë‹ˆë‹¤.\në§ˆìŒë§Œ ì „í•´ ì£¼ì‹œë ¤ë©´ ì•„ëž˜ QR ì½”ë“œë¥¼ ì´ìš©í•´ ì£¼ì„¸ìš”.",
    giftQrUsd: "USD QR ì½”ë“œ",
    giftQrKhr: "KHR QR ì½”ë“œ",
    sectionRsvp: "RSVP",
    rsvpDesc: "ì°¸ì„í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.",
    rsvpBtn: "â–¼ ì°¸ì„ ì—¬ë¶€ ì•Œë ¤ì£¼ê¸°",
    rsvpConfirmed: "âœ… ì°¸ì„ í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤!",
    footerBlessing: "ê°ì‚¬í•˜ë©° í–‰ë³µì„ ë¹•ë‹ˆë‹¤ ðŸ™",
    footerQuote: "ë‘ ë§ˆìŒ, í•˜ë‚˜ì˜ ì‚¬ëž‘, ì•„ë¦„ë‹¤ìš´ ì¸ì—°",
    invitation: {
      title: "ê²°í˜¼ì‹ì— ì´ˆëŒ€í•©ë‹ˆë‹¤",
      message: "ëˆˆë¶€ì‹œê²Œ ì°¬ëž€í•œ ë‚ , ì €í¬ ë¶€ë¶€ê°€ ë©ë‹ˆë‹¤.\nìž‘ì€ ì¼ìƒì´ ì¼ìƒì´ ë˜ëŠ” ë‚ ,\në‚˜ëž€ížˆ ì˜ˆì˜ê²Œ ì‚´ì•„ê°€ê² ìŠµë‹ˆë‹¤.\n\nìš°ë¦¬ì˜ ì²« ê±¸ìŒì„\nì¶•ë³µí•´ ì£¼ì‹œê¸° ë°”ëžë‹ˆë‹¤.",
      groomParents: "ì‹ ëž‘ ì¸¡ ë¶€ëª¨",
      groomFather: "ì•„ë²„ì§€",
      groomMother: "ì–´ë¨¸ë‹ˆ",
      brideParents: "ì‹ ë¶€ ì¸¡ ë¶€ëª¨",
      brideFather: "ì•„ë²„ì§€",
      brideMother: "ì–´ë¨¸ë‹ˆ",
      groom: "ì‹ ëž‘",
      bride: "ì‹ ë¶€",
      and: "ê·¸ë¦¬ê³ ",
      dateTime: "2026ë…„ 3ì›” 25ì¼ ìˆ˜ìš”ì¼ ì˜¤ì „ 11ì‹œ",
      venue: "ìž¥ì†Œ ì´ë¦„",
      address: "ì£¼ì†Œ",
      rsvp: "ì°¸ì„ ì—¬ë¶€",
      confirm: "ì°¸ì„",
      decline: "ë¶ˆì°¸"
    },
    schedule: [
      { time: "ì˜¤ì „ 6:30", desc: "ì¹œì²™Â·í•˜ê° ëª¨ìž„, ì˜ˆë¹„ì§„ ì¤€ë¹„" },
      { time: "ì˜¤ì „ 7:00", desc: "ëŒ€ê¸¸ í–‰ë ¬" },
      { time: "ì˜¤ì „ 7:45", desc: "ì˜ˆë¹„ì§„ ëŒ€ê¸° (ìž¥ì‹ ì°©ìš©)" },
      { time: "ì˜¤ì „ 8:15", desc: "ìŠ¤ë‹˜ ë…ê²½" },
      { time: "ì˜¤ì „ 9:15", desc: "í—¤ì–´ ì»·íŒ…Â·ìºìŠ¤ì¼€ì´ë“œ" },
      { time: "ì˜¤ì „ 10:40", desc: "ì¼€ë¤ ë°°ë¡€, ë² ìŠ¤ë‚˜ë°ì´í‘¼, ì† ìž¡ê¸°" },
      { time: "ì˜¤ì „ 11:30", desc: "ì ì‹¬ ì‹ì‚¬" },
      { time: "ì˜¤í›„ 5:00", desc: "ì €ë… ì‹ì‚¬" }
    ]
  },
  en: {
    pageTitle: "Wedding Invitation",
    heroTopline: "W E D D I N G   I N V I T A T I O N",
    heroTitle: "Wedding Invitation",
    guestLabel: "You Are Invited",
    invitationMessage: "On this dazzlingly bright day, we become husband and wife.\nThe day our small daily moments become a lifetime,\nwe will live beautifully side by side.\n\nWe would be honored if you could bless our first steps together.",
    dateLine: "March 24â€“25, 2026",
    cdDays: "Days",
    cdHours: "Hours",
    cdMins: "Mins",
    cdSecs: "Secs",
    venueTitle: "Venue",
    venueSubtitle: "Venue Name",
    mapClick: "View in Google Maps",
    openMaps: "Open in Google Maps",
    scanQR: "Scan QR Code",
    sectionSchedule: "Wedding Programme",
    sectionScheduleSub: "Programme â€” March 25, 2026",
    scheduleDate: "ðŸ—“ March 25, 2026",
    sectionVenue: "Location",
    sectionGallery: "Gallery",
    sectionGallerySub: "Wedding Photos",
    sectionGift: "Gifts",
    giftDesc: "Your presence is our greatest gift. If you wish to send a gift, you may use the QR codes below.",
    giftQrUsd: "QR Code USD",
    giftQrKhr: "QR Code KHR",
    sectionRsvp: "RSVP",
    rsvpDesc: "Thank you for joining us.",
    rsvpBtn: "â–¼ Confirm attendance",
    rsvpConfirmed: "âœ… Confirmed!",
    footerBlessing: "Thank you & best wishes ðŸ™",
    footerQuote: "Two hearts, one love, one beautiful destiny",
    invitation: {
      title: "You Are Invited to Our Wedding",
      message: "On this dazzlingly bright day, we become husband and wife.\nThe day our small daily moments become a lifetime,\nWe will live beautifully side by side.\n\nWe would be honored if you could bless our first steps together.",
      groomParents: "Groom's Parents",
      groomFather: "Father",
      groomMother: "Mother",
      brideParents: "Bride's Parents",
      brideFather: "Father",
      brideMother: "Mother",
      groom: "Groom",
      bride: "Bride",
      and: "and",
      dateTime: "Wednesday, March 25, 2026 at 11:00 AM",
      venue: "Venue Name",
      address: "Address",
      rsvp: "RSVP",
      confirm: "Attending",
      decline: "Unable to Attend"
    },
    schedule: [
      { time: "6:30 AM", desc: "Family & guests gather, preparation" },
      { time: "7:00 AM", desc: "Procession" },
      { time: "7:45 AM", desc: "Pre-ceremony (adornments)" },
      { time: "8:15 AM", desc: "Monk blessing" },
      { time: "9:15 AM", desc: "Hair cutting ceremony" },
      { time: "10:40 AM", desc: "Ketem pay, Besnadai Poun, hand binding" },
      { time: "11:30 AM", desc: "Lunch" },
      { time: "5:00 PM", desc: "Dinner" }
    ]
  },
  km: {
    pageTitle: "áž€áž¶ážšáž¢áž‰áŸ’áž‡áž¾áž‰áž…áž¼áž›ážšáž½áž˜áž–áž·áž’áž¸áž˜áž„áŸ’áž‚áž›áž€áž¶ážš",
    heroTopline: "W E D D I N G   I N V I T A T I O N",
    heroTitle: "ážŸáž·ážšáž¸áž˜áž„áŸ’áž‚áž›áž¢áž¶áž–áž¶áž áŸáž–áž·áž–áž¶áž áŸ",
    guestLabel: "ážŸáž¼áž˜áž‚áŸ„ážšáž–áž¢áž‰áŸ’áž‡áž¾áž‰",
    invitationMessage: "áž…áž¼áž›ážšáž½áž˜áž‡áž¶áž—áŸ’áž‰áŸ€ážœáž€áž·ážáŸ’ážáž·áž™ážŸ ážŠáž¾áž˜áŸ’áž”áž¸áž”áŸ’ážšážŸáž·áž‘áŸ’áž’áž·áž–ážšáž‡áŸáž™ ážŸáž·ážšáž¸ážŸáž½ážŸáŸ’ážŠáž¸ áž‡áŸáž™áž˜áž„áŸ’áž‚áž› áž€áŸ’áž“áž»áž„áž–áž·áž’áž¸áž¢áž¶áž–áž¶áž áŸáž–áž·áž–áž¶áž áŸ ážšáž”ážŸáŸ‹áž™áž¾áž„ážáŸ’áž‰áž»áŸ†áž‘áž¶áŸ†áž„áž–áž¸ážšáŸ”",
    dateLine: "ážáŸ’áž„áŸƒáž‘áž¸ áŸ¢áŸ¤ - áŸ¢áŸ¥ ážáŸ‚ áž˜áž¸áž“áž¶ áž†áŸ’áž“áž¶áŸ† áŸ¢áŸ áŸ¢áŸ¦",
    cdDays: "ážáŸ’áž„áŸƒ",
    cdHours: "áž˜áŸ‰áŸ„áž„",
    cdMins: "áž“áž¶áž‘áž¸",
    cdSecs: "ážœáž·áž“áž¶áž‘áž¸",
    venueTitle: "áž‘áž¸ážáž¶áŸ†áž„áž€áž˜áŸ’áž˜ážœáž·áž’áž¸áž˜áž„áŸ’áž‚áž›",
    venueSubtitle: "áž‚áŸáž ážŠáŸ’áž‹áž¶áž“ážáž¶áž„ážŸáŸ’ážšáž¸ áž—áž¼áž˜áž·áž›áŸ’ážœáŸ áž™áŸ†áž–áŸ’ážšáž¶áŸ†áž„ážŸáŸ’áž“áž¶áž™ ážŸáŸ’ážšáž»áž€ážŽáž¼áž™ áž€ážáŸážáŸ’ážáž€áŸ†áž–áž",
    mapClick: "áž…áž»áž…ážŠáž¾áž˜áŸ’áž”áž¸áž˜áž¾áž›áž‘áž¸ážáž¶áŸ†áž„áž€áŸ’áž“áž»áž„ Google Maps",
    openMaps: "áž”áž¾áž€áž€áŸ’áž“áž»áž„ Google Maps",
    scanQR: "ážŸáŸ’áž€áŸáž“ QR Code",
    sectionSchedule: "áž€áž˜áŸ’áž˜ážœáž·áž’áž¸ážŸáž·ážšáž¸áž˜áž„áŸ’áž‚áž›áž¢áž¶áž–áž¶áž áŸáž–áž·áž–áž¶áž áŸ",
    sectionScheduleSub: "áž€áž˜áŸ’áž˜ážœáž·áž’áž¸ážáŸ’áž„áŸƒáž‘áž¸ áŸ¢áŸ¥ ážáŸ‚ áž˜áž¸áž“áž¶ áž†áŸ’áž“áž¶áŸ† áŸ¢áŸ áŸ¢áŸ¦",
    scheduleDate: "ðŸ—“ ážáŸ’áž„áŸƒáž‘áž¸ áŸ¢áŸ¥ ážáŸ‚ áž˜áž¸áž“áž¶ áŸ¢áŸ áŸ¢áŸ¦",
    sectionVenue: "áž‘áž¸ážáž¶áŸ†áž„áž€áž˜áŸ’áž˜ážœáž·áž’áž¸áž˜áž„áŸ’áž‚áž›",
    sectionGallery: "ážšáž¼áž”áž—áž¶áž–",
    sectionGallerySub: "ážšáž¼áž”áž—áž¶áž–áž–áž·áž’áž¸áž¢áž¶áž–áž¶áž áŸáž–áž·áž–áž¶áž áŸ",
    sectionGift: "áž¢áŸ†ážŽáŸ„áž™áž¢áž¶áž–áž¶áž áŸáž–áž·áž–áž¶áž áŸ",
    giftDesc: "áž€áž¶ážšáž˜áž€áž…áž¼áž›ážšáž½áž˜ážšáž”ážŸáŸ‹áž¢áŸ’áž“áž€áž‚ážºáž‡áž¶áž¢áŸ†ážŽáŸ„áž™ážŠáŸáž’áŸ†áž”áŸ†áž•áž»áž áž”áŸ‰áž»áž“áŸ’ážáŸ‚áž”áŸ’ážšážŸáž·áž“áž”áž¾áž¢áŸ’áž“áž€áž…áž„áŸ‹áž‚áž½áž›áž¢áŸ†ážŽáŸ„áž™ áž¢áŸ’áž“áž€áž¢áž¶áž…áž”áŸ’ážšáž¾ QR Code ážáž¶áž„áž€áŸ’ážšáŸ„áž˜",
    giftQrUsd: "áž”áž‰áŸ’áž‡áž¶áž€áŸ‹ QR Code USD",
    giftQrKhr: "áž”áž‰áŸ’áž‡áž¶áž€áŸ‹ QR Code KHR",
    sectionRsvp: "RSVP",
    rsvpDesc: "ážŸáž¼áž˜áž¢ážšáž‚áž»ážŽážŸáž˜áŸ’ážšáž¶áž”áŸ‹áž€áž¶ážšáž…áž¼áž›ážšáž½áž˜ážšáž”ážŸáŸ‹áž¢áŸ’áž“áž€",
    rsvpBtn: "â–¼ áž”áž‰áŸ’áž‡áž¶áž€áŸ‹áž‘áž˜áŸ’ážšáž„áŸ‹",
    rsvpConfirmed: "âœ… áž”áž¶áž“áž”áž‰áŸ’áž‡áž¶áž€áŸ‹ážšáž½áž…áž áž¾áž™!",
    footerBlessing: "ážŸáž¼áž˜áž¢ážšáž‚áž»ážŽ áž“áž·áž„ áž‡áž¼áž“áž–ážš ážŸáž»áž—áž˜áž„áŸ’áž‚áž› ðŸ™",
    footerQuote: "Two hearts, one love, one beautiful destiny",
    invitation: {
      title: "ážŸáž¼áž˜áž¢áž‰áŸ’áž‡áž¾áž‰áž…áž¼áž›ážšáž½áž˜áž–áž·áž’áž¸áž˜áž„áŸ’áž‚áž›áž€áž¶ážš",
      message: "áž“áŸ…ážáŸ’áž„áŸƒážŠáŸáž—áŸ’áž›ážºáž…áŸ‚áž„áž…áž¶áŸ†áž„áž“áŸáŸ‡ áž™áž¾áž„ážáŸ’áž‰áž»áŸ†áž“áž¹áž„áž€áŸ’áž›áž¶áž™áž‡áž¶áž”áŸ’ážáž¸áž”áŸ’ážšáž–áž“áŸ’áž’áŸ”\nážáŸ’áž„áŸƒážŠáŸ‚áž›áž‡áž¸ážœáž·ážáž”áŸ’ážšáž…áž¶áŸ†ážáŸ’áž„áŸƒážáž¼áž…áŸ—ážšáž”ážŸáŸ‹áž™áž¾áž„áž€áŸ’áž›áž¶áž™áž‡áž¶áž‡áž¸ážœáž·ážáž‘áž¶áŸ†áž„áž˜áž¼áž›\náž™áž¾áž„áž“áž¹áž„ážšážŸáŸ‹áž“áŸ…ážŠáŸ„áž™ážŸáž»áž—áž˜áž„áŸ’áž‚áž›áž‡áž¶áž˜áž½áž™áž‚áŸ’áž“áž¶áŸ”\n\nážŸáž¼áž˜áž¢áž‰áŸ’áž‡áž¾áž‰áž˜áž€áž”áŸ’ážšáž‘áž¶áž“áž–ážšážŠáž›áŸ‹áž‡áŸ†áž áž¶áž“ážŠáŸ†áž”áž¼áž„ážšáž”ážŸáŸ‹áž™áž¾áž„ážáŸ’áž‰áž»áŸ†áŸ”",
      groomParents: "ážªáž–áž»áž€áž˜áŸ’ážáž¶áž™áž€áž¼áž“áž”áŸ’ážšáž»ážŸ",
      groomFather: "ážªáž–áž»áž€",
      groomMother: "áž˜áŸ’ážáž¶áž™",
      brideParents: "ážªáž–áž»áž€áž˜áŸ’ážáž¶áž™áž€áž¼áž“ážŸáŸ’ážšáž¸",
      brideFather: "ážªáž–áž»áž€",
      brideMother: "áž˜áŸ’ážáž¶áž™",
      groom: "áž€áž¼áž“áž”áŸ’ážšáž»ážŸ",
      bride: "áž€áž¼áž“ážŸáŸ’ážšáž¸",
      and: "áž“áž·áž„",
      dateTime: "ážáŸ’áž„áŸƒáž–áž»áž’ áž‘áž¸áŸ¢áŸ¥ ážáŸ‚áž˜áž¸áž“áž¶ áž†áŸ’áž“áž¶áŸ†áŸ¢áŸ áŸ¢áŸ¦ áž˜áŸ‰áŸ„áž„ áŸ¡áŸ¡:áŸ áŸ  ážáŸ’áž„áŸƒážáŸ’ážšáž„áŸ‹",
      venue: "ážˆáŸ’áž˜áŸ„áŸ‡áž‘áž¸áž€áž“áŸ’áž›áŸ‚áž„",
      address: "áž¢áž¶ážŸáž™ážŠáŸ’áž‹áž¶áž“",
      rsvp: "áž”áž‰áŸ’áž‡áž¶áž€áŸ‹áž€áž¶ážšáž…áž¼áž›ážšáž½áž˜",
      confirm: "áž…áž¼áž›ážšáž½áž˜",
      decline: "áž˜áž·áž“áž¢áž¶áž…áž…áž¼áž›ážšáž½áž˜"
    },
    schedule: [
      { time: "áž˜áŸ‰áŸ„áž„ áŸ¦:áŸ£áŸ  áž“áž¶áž‘áž¸áž–áŸ’ážšáž¹áž€", desc: "áž•áŸ’áž‚áž»áŸ†ážŠáž»áŸ†ážŸáž¶áž…áŸ‹áž‰áž¶ážáž· áž—áŸ’áž‰áŸ€ážœáž€áž·ážáŸ’ážáž·áž™ážŸ ážŠáž¾áž˜áŸ’áž”áž¸ážšáŸ€áž”áž…áŸ†áž–áž·áž’áž¸ážáŸ‚ážšáž–ážšáž‡áž·áž“" },
      { time: "áž˜áŸ‰áŸ„áž„ áŸ§:áŸ áŸ  áž“áž¶áž‘áž¸áž–áŸ’ážšáž¹áž€", desc: "áž–áž·áž’áž¸áž áŸ‚ážšáž€áŸ†ážŽáž¶ážáŸ‹áž…áž¼áž›áž˜áž áž¶áž‡áŸáž™" },
      { time: "áž˜áŸ‰áŸ„áž„ áŸ§:áŸ¤áŸ¥ áž“áž¶áž‘áž¸áž–áŸ’ážšáž¹áž€", desc: "áž–áž·áž’áž¶ážŸáŸ’áž“áž¶áž€áŸážŽáž¶áž€áŸ‹áž”áž»ážšáž¸áž“áž‡áž·áž“ (áž”áŸ†áž–áž¶áž€áŸ‹áž‚áŸ’ážšáž¿áž„áž¢áž›áž„áŸ’áž€áž¶ážš)" },
      { time: "áž˜áŸ‰áŸ„áž„ áŸ¨:áŸ¡áŸ¥ áž“áž¶áž‘áž¸áž–áŸ’ážšáž¹áž€", desc: "áž“áž·áž˜áž“áŸ’ážáž–áŸ’ážšáŸ‡ážŸáž„áŸ’ážƒážŸáž¼ážáŸ’ážšáž˜áž“áŸ’áž" },
      { time: "áž˜áŸ‰áŸ„áž„ áŸ©:áŸ¡áŸ¥ áž“áž¶áž‘áž¸áž–áŸ’ážšáž¹áž€", desc: "áž–áž·áž’áž¸áž€áž¶ážáŸ‹ážŸáž€áŸ‹áž”áž„áŸ’áž€áž€áŸ‹ážŸáž¸ážšáž¸" },
      { time: "áž˜áŸ‰áŸ„áž„ áŸ¡áŸ :áŸ¤áŸ  áž“áž¶áž‘áž¸áž–áŸ’ážšáž¹áž€", desc: "áž–áž·áž’áž¸ážŸáŸ†áž–áŸ‡áž€áŸážŠáž¹áž˜ áž”áž„áŸ’ážœáž·áž›áž–áž–áž·áž› ážœáŸ‚ážŸáž“ážŠáž¸áž•áž½áž“ ážŠáž¸áž‚áž¶ áž”áž¶áž…áž•áŸ’áž€áž¶ážŸáŸ’áž“áž¶ áž…áž„ážŠáŸƒ" },
      { time: "áž˜áŸ‰áŸ„áž„ áŸ¡áŸ¡:áŸ£áŸ  áž“áž¶áž‘áž¸áž–áŸ’ážšáž¹áž€", desc: "áž¢áž‰áŸ’áž‡áž¾áž‰áž—áŸ’áž‰áŸ€ážœáž–áž·ážŸáž¶ážšáž¢áž¶áž áž¶ážšážáŸ’áž„áŸƒážáŸ’ážšáž„áŸ‹" },
      { time: "áž˜áŸ‰áŸ„áž„ áŸ¥ áž–áŸáž›áž›áŸ’áž„áž¶áž…", desc: "áž¢áž‰áŸ’áž‡áž¾áž‰áž—áŸ’áž‰áŸ€ážœáž€áž·ážáŸ’ážáž·áž™ážŸáž–áž·ážŸáž¶ážšáž¢áž¶áž áž¶ážšáž–áŸáž›áž›áŸ’áž„áž¶áž… ážŠáŸ„áž™áž˜áŸážáŸ’ážšáž¸áž€áž¶áž–" }
    ]
  }
};

/** Get stored language or detect from browser; default ko */
function getPreferredLanguage() {
  const stored = localStorage.getItem("wedding-lang");
  if (stored && (stored === "ko" || stored === "en" || stored === "km")) return stored;
  const browser = (navigator.language || navigator.userLanguage || "").toLowerCase();
  if (browser.startsWith("ko")) return "ko";
  if (browser.startsWith("km") || browser.startsWith("khm")) return "km";
  if (browser.startsWith("en")) return "en";
  return "ko";
}

/** Resolve nested key like "invitation.message" */
function getTranslation(lang, key) {
  const t = translations[lang] || translations.ko;
  return key.split(".").reduce((obj, k) => (obj && obj[k] != null ? obj[k] : null), t);
}

/** Apply language: update document, body font, and all [data-i18n] elements (no reload) */
function setLanguage(lang) {
  if (!translations[lang]) lang = "ko";
  localStorage.setItem("wedding-lang", lang);
  document.documentElement.lang = lang === "ko" ? "ko" : lang === "km" ? "km" : "en";
  document.body.setAttribute("data-lang", lang);
  document.title = getTranslation(lang, "pageTitle") + " â€” VONG Sovanthoeun & ROENG Vila";

  const fontMap = {
    ko: "'Noto Sans KR', 'Poppins', sans-serif",
    en: "'Poppins', 'Playfair Display', sans-serif",
    km: "'Noto Serif Khmer', 'Poppins', sans-serif"
  };
  document.body.style.fontFamily = fontMap[lang] || fontMap.ko;

  document.querySelectorAll("[data-i18n]").forEach(function (el) {
    const key = el.getAttribute("data-i18n");
    const value = getTranslation(lang, key);
    if (value == null) return;
    const tag = (el.tagName || "").toLowerCase();
    if (tag === "input" || tag === "textarea") {
      if (el.placeholder !== undefined) el.placeholder = value;
    } else {
      el.textContent = value;
    }
  });

  document.querySelectorAll("[data-i18n-html]").forEach(function (el) {
    const key = el.getAttribute("data-i18n-html");
    const value = getTranslation(lang, key);
    if (value != null) el.innerHTML = value.replace(/\n/g, "<br>");
  });

  const cdLabels = ["cdDays", "cdHours", "cdMins", "cdSecs"];
  cdLabels.forEach(function (k, i) {
    const nodes = document.querySelectorAll("[data-i18n-countdown=\"" + k + "\"]");
    const text = getTranslation(lang, k);
    if (text) nodes.forEach(function (n) { n.textContent = text; });
  });

  const schedule = getTranslation(lang, "schedule");
  if (Array.isArray(schedule)) {
    document.querySelectorAll("[data-i18n-schedule-time]").forEach(function (el, i) {
      if (schedule[i]) el.textContent = schedule[i].time;
    });
    document.querySelectorAll("[data-i18n-schedule-desc]").forEach(function (el, i) {
      if (schedule[i]) el.textContent = schedule[i].desc;
    });
  }

  document.querySelectorAll(".lang-switcher [data-lang]").forEach(function (btn) {
    btn.classList.toggle("active", btn.getAttribute("data-lang") === lang);
  });
}
